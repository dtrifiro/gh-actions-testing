name: github actions testing

on:
  push:
  workflow_dispatch:

jobs:
  testing:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v3
      - name: install tmate
        run: |
          brew install tmate

      - name: Use colima as default docker host on MacOS
        run: |
          brew install docker
          colima start
          ls -la $HOME/.colima/default/docker.sock
          sudo ln -sf $HOME/.colima/default/docker.sock /var/run/docker.sock
          ls -la /var/run/docker.sock

      - name: run container
        run: |
          docker pull python:3.12-slim
          docker run -it -d -p 8000:8000 python:3.12-slim python -m http.server
          curl localhost:8000

      - name: run tmate
        if: failure()
        run: |
          tmate -F
